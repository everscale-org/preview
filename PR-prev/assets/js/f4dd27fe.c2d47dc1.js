"use strict";(self.webpackChunkeverscale_docs_website=self.webpackChunkeverscale_docs_website||[]).push([[5848],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>f});var a=r(7294);function s(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function o(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?n(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function i(e,t){if(null==e)return{};var r,a,s=function(e,t){if(null==e)return{};var r,a,s={},n=Object.keys(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||(s[r]=e[r]);return s}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)r=n[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s}var p=a.createContext({}),l=function(e){var t=a.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):o(o({},t),e)),r},c=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var r=e.components,s=e.mdxType,n=e.originalType,p=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=l(r),m=s,f=d["".concat(p,".").concat(m)]||d[m]||u[m]||n;return r?a.createElement(f,o(o({ref:t},c),{},{components:r})):a.createElement(f,o({ref:t},c))}));function f(e,t){var r=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var n=r.length,o=new Array(n);o[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i[d]="string"==typeof e?e:s,o[1]=i;for(var l=2;l<n;l++)o[l]=r[l];return a.createElement.apply(null,o)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},4642:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>n,metadata:()=>i,toc:()=>l});var a=r(7462),s=(r(7294),r(3905));const n={sidebar_position:2,description:"Send message and subscribe for REMP receipts in GraphQL"},o="Work with REMP in GraphQL",i={unversionedId:"develop/tutorial/graphql-api-guides/remp",id:"develop/tutorial/graphql-api-guides/remp",title:"Work with REMP in GraphQL",description:"Send message and subscribe for REMP receipts in GraphQL",source:"@site/../../src/develop/tutorial/graphql-api-guides/remp.md",sourceDirName:"develop/tutorial/graphql-api-guides",slug:"/develop/tutorial/graphql-api-guides/remp",permalink:"/preview/PR-prev/develop/tutorial/graphql-api-guides/remp",draft:!1,editUrl:"https://github.com/everscale-org/docs/edit/main/.build/website/../../src/develop/tutorial/graphql-api-guides/remp.md",tags:[],version:"current",lastUpdatedAt:1679933170,formattedLastUpdatedAt:"Mar 27, 2023",sidebarPosition:2,frontMatter:{sidebar_position:2,description:"Send message and subscribe for REMP receipts in GraphQL"},sidebar:"tutorialSidebar",previous:{title:"Get Started with Evercloud",permalink:"/preview/PR-prev/develop/tutorial/graphql-api-guides/evercloud-start"},next:{title:"Smart Digital Assets",permalink:"/preview/PR-prev/develop/tutorial/smart-digital-assets"}},p={},l=[{value:"Send message",id:"send-message",level:2},{value:"Subscribe for REMP receipts",id:"subscribe-for-remp-receipts",level:2},{value:"gql playground",id:"gql-playground",level:3},{value:"wscat",id:"wscat",level:3},{value:"Result message payload example",id:"result-message-payload-example",level:3},{value:"Error payload",id:"error-payload",level:3},{value:"Full docs",id:"full-docs",level:2}],c={toc:l},d="wrapper";function u(e){let{components:t,...r}=e;return(0,s.kt)(d,(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("h1",{id:"work-with-remp-in-graphql"},"Work with REMP in GraphQL"),(0,s.kt)("h2",{id:"send-message"},"Send message"),(0,s.kt)("p",null,"Use mutation postRequests to send a message to blockchain."),(0,s.kt)("p",null,"You can send a batch of queries with this API."),(0,s.kt)("p",null,"Use ",(0,s.kt)("a",{parentName:"p",href:"https://docs.everos.dev/ever-sdk/reference/types-and-methods/mod_boc#get_boc_hash"},"this function")," to calculate message hash. "),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'mutation{\n  postRequests(requests:[\n    {\n      id: "tvm-hash-of-message-boc-in-base64"\n      body: "message-body-in-base64"\n    }\n  ])\n}\n')),(0,s.kt)("p",null,(0,s.kt)("img",{parentName:"p",src:"https://2546896325-files.gitbook.io/~/files/v0/b/gitbook-x-prod.appspot.com/o/spaces%2Fu8iA3ji82Xtk5tqBULVH%2Fuploads%2FsrgXrQoeLu9vctMjW6FO%2Fimage.png?alt=media&token=c4ba3984-7af0-429c-bd6b-1e1891fe81dd",alt:null})),(0,s.kt)("h2",{id:"subscribe-for-remp-receipts"},"Subscribe for REMP receipts"),(0,s.kt)("p",null," After sending an external inbound message you can subscribe for its processing."),(0,s.kt)("p",null,"This feature may be good if you want to make your application more responsive and user-friendly by providing detailed information about message processing stages to the user."),(0,s.kt)("p",null,"Use subscription ",(0,s.kt)("inlineCode",{parentName:"p"},"rempReceipts")," to receive message processing statuses."),(0,s.kt)("p",null,"Subscription returns an error message and closes if the first receipt is not received within 5 seconds, and if any subsequent receipt is not received within 60 seconds after the previous receipt."),(0,s.kt)("p",null,"You can subscribe for receipts directly from API or you can use ever-sdk ",(0,s.kt)("inlineCode",{parentName:"p"},"process_message")," function to receive these statuses into the callback. ",(0,s.kt)("a",{parentName:"p",href:"https://github.com/tonlabs/sdk-samples/blob/master/core-examples/node-js/remp/index.js"},"See the sample. ")),(0,s.kt)("h3",{id:"gql-playground"},"gql playground"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'subscription{\n  rempReceipts(messageId: "082a5c2ab5b68b0ef9b8ced4fa865933ab19603f5171ec1190f3f45943214de0"){\n    messageId\n    timestamp\n    json\n    kind\n  }\n}\n')),(0,s.kt)("h3",{id:"wscat"},"wscat"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre"},'wscat -c wss://mainnet.evercloud.dev/your-project-id/graphql -s graphql-ws\n{"id":"1","type":"start","payload":{"variables":{},"extensions":{},"operationName":null,"query":"subscription{rempReceipts(messageId:\\"082a5c2ab5b68b0ef9b8ced4fa865933ab19603f5171ec1190f3f45943214de0\\"){messageId,timestamp,json,kind}}"}}\n')),(0,s.kt)("h3",{id:"result-message-payload-example"},"Result message payload example"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "data": {\n    "rempReceipts": {\n      "messageId": "082a5c2ab5b68b0ef9b8ced4fa865933ab19603f5171ec1190f3f45943214de0",\n      "timestamp": 0,\n      "json": "{\\"message_id\\":\\"082a5c2ab5b68b0ef9b8ced4fa865933ab19603f5171ec1190f3f45943214de0\\",\\"timestamp\\":0,\\"source_id\\":\\"a0573b3f9ed4e78781250a8a6955e930ffbde24e35d50b85dd2cf50f1d6ef30e\\",\\"signature\\":\\"\\",\\"kind\\":\\"PutIntoQueue\\"}",\n      "kind": "Other"\n    }\n  }\n}\n\n')),(0,s.kt)("h3",{id:"error-payload"},"Error payload"),(0,s.kt)("p",null,"If no receipt was received within a timeout (5 seconds for the first receipt, and 60 seconds for next receipts), there will be a ws message with ",(0,s.kt)("inlineCode",{parentName:"p"},"error")," type and this payload:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "error": {\n    "name": "Error",\n    "message": "Timeout"\n  }\n}\n')),(0,s.kt)("h2",{id:"full-docs"},"Full docs"),(0,s.kt)("p",null,"REMP Architecture documentation: "),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://docs.everscale.network/arch/remp"},"https://docs.everscale.network/arch/remp")),(0,s.kt)("p",null,"See original guides at: "),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://docs.evercloud.dev/samples/graphql-samples/send-message"},"https://docs.evercloud.dev/samples/graphql-samples/send-message")),(0,s.kt)("p",null,(0,s.kt)("a",{parentName:"p",href:"https://docs.evercloud.dev/samples/graphql-samples/subscribe-for-remp-receipts"},"https://docs.evercloud.dev/samples/graphql-samples/subscribe-for-remp-receipts")),(0,s.kt)("p",null,"Full GraphQL API documenation is available at ",(0,s.kt)("a",{parentName:"p",href:"https://docs.everos.dev/ever-platform/reference/graphql-api"},"https://docs.everos.dev/ever-platform/reference/graphql-api")))}u.isMDXComponent=!0}}]);